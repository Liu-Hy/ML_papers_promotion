# GenoMAS：当“会写代码的多智能体”走进基因表达分析

## 引言：把代码放回科学的中心

在不少关于智能体的讨论里，人们关注它能否检索资料、调用工具、或做出漂亮的计划。但在科学研究里，决定结果是否可信的，往往不是“计划写得多好”，而是“这些计划是否被落实为可执行、可审查、可回退的代码”。基因表达分析就是这样一个典型场景：数据高维而嘈杂，跨平台异质，基因命名持续演化，批次效应与隐性混杂随处可见。一个看似普通的基因—表型关联（GTA）问题，往往要穿过几十步相互依赖的处理环节。哪怕每一步只有5%的失误率，二十步之后端到端成功率也会跌破36%。这正是为什么复杂的转录组工作流长期依赖少数资深生信工程师。

我们提出的 GenoMAS（Genomic data analysis through LLM-based Multi-Agent System），用一种朴实的方式回答这个难题：把“代码”放在系统的中心位置，让一支分工明确的多智能体团队围绕代码协作，在遵循高层指南的前提下，针对数据的具体情况灵活决策、纠错和回溯。

![GenoMAS系统协作示意图](GenoMAS_figs/System_diagram.png)

_图1 GenoMAS系统：六位“会写代码的AI科学家”协作完成端到端基因表达分析_

## 为什么自动化转录组分析这么难

困难并不在于“有没有一个更大的模型”，而在于“是否把数据和变量处理对了”。高维稀疏带来的统计挑战、微阵列与RNA-seq在处理链路上的差异、基因符号的同义与废弃、异构临床元数据的标准化、以及批次效应与共变量处理的细枝末节，都会在早期决定结论的走向。很多时候，能否在代码层面把这些细节处理到位，才是科学有效性的关键。

## 方法：以代码为中心的多智能体协作

GenoMAS由六个角色组成：PI负责整体编排与并行度；两位数据工程师分别面向GEO与TCGA做预处理；统计学家进行回归建模与显著基因识别；代码审稿人把关实现是否可执行、是否符合指令；领域专家提供生物学判断（如临床特征抽取、基因符号规范化）。团队通过“带类型”的消息协议协作，谁在写代码、谁提出审阅、谁给出通过或驳回理由，都有清晰的结构约束，便于追踪与治理。

系统的核心是“指导式规划”。用户给出可编辑的高层指南，系统自动拆分为带依赖关系的行动单元（Action Unit），形成一个可执行的有向无环图。编程智能体据此推进实现，但在每一步可以根据上下文选择前进、修订、绕行或回退，从而在可控与灵活之间找到平衡。我们刻意采用“认知多样性”的异构模型组合：擅长编码执行的模型承担代码撰写，推理能力强的模型主导规划与审查，生物学把握好的模型提供领域判断；实践中，异构组合在准确性与成本上都优于同构配置。

在实现层面，我们把知识与经验落到“本地、版本化”的资产上：集成NCBI Gene的同义词表与Open Targets的基因—性状线索，保证可复现与可追溯；同时用“代码记忆”机制沉淀已验证的高频片段，例如GEO加载、基因符号映射、归一化等，在相似场景下直接复用，既提升效率，也降低错误率。

![编程智能体的规划、记忆与自我纠错机制](GenoMAS_figs/Programming_agent.png)

_图2 编程智能体的规划、记忆与自我纠错：在行动单元层面决定前进、回退、咨询或重写，并沉淀可复用代码_

## 实验与发现：不止“跑通”，更要“跑对”

我们在GenoTEX基准上做了系统评估，覆盖913个真实队列、132个性状、共1,384个GTA任务，端到端考察“数据选择—预处理—统计分析”的全链路能力。结果显示，GenoMAS在数据预处理的综合相似相关（CSC）为89.13%，在显著基因识别上的F1为60.48%，分别比此前最佳方法提升10.61%与16.85%；端到端成功率达到98.78%，API成本下降44.7%。

为了把统计分析本身与预处理解耦，我们在“专家已预处理数据”的受控场景下进行评测，GenoMAS的F1达到95.26%。而一旦去掉批次效应矫正（如ComBat），F1会降至69.64%。这说明，在真实科研里，决定性因素常常不是“大模型换代”，而是是否在代码层面把批次、共变量、缺失值等问题处理干净。

把视角放回预处理环节，GenoMAS在基因表达矩阵上的CSC约为91%，而在临床性状这一更依赖语义理解与生物知识的环节，CSC显著偏低（约33%）。这既揭示了当前主要瓶颈，也指明了改进方向：提升临床特征抽取、命名标准化与隐性混杂识别的能力，才能进一步改善端到端表现。

从系统机制看，“代码记忆”带来实打实的效率提升。我们跟踪前50个队列的运行，复用率很快稳定在约65%，累计节省57.8分钟，平均每个复用步骤节省约20秒，把有限的计算与推理预算释放到真正棘手的队列特异问题上。消融实验也印证了各组件的价值：缺少规划机制、领域专家或多轮审稿，性能都会明显下滑；完全关闭审稿时，F1只有约四分之一。相对地，单纯依赖“语言模型的参数记忆”而不看数据，AUROC大约只有0.56，基本不具备科研可用性。

## 协作模式：高自治、低开销的团队

我们统计了一个代表性会话中的消息交互网络，数据工程师承担了超过一半的通信量，统计学家负责下游建模；PI只用极少的消息完成全局编排，系统的自治性很高。消息类型中，规划请求与响应占比最高，其次是代码审阅与修订，这与我们观察到的高成功率、低错误率是一致的。换句话说，可靠的结果来自“有约束的自主”，而不是完全放任的自由。

![多智能体协作网络与消息分布](GenoMAS_figs/Agent_collaboration_patterns.jpg)

_图3 多智能体协作网络与消息分布：编程与顾问角色高频交互，PI以极低通信量实现稳定编排_

## 局限与展望：把“最后一公里”走稳

目前系统在临床性状抽取与标准化上的能力仍有改进空间，这一环节的噪声与异质性远高于基因表达矩阵本身。接下来我们将继续两条路径：一是走向多模态，逐步把甲基化、蛋白质组学等数据纳入统一分析；二是把规划做得更细更可验证，让“何时绕行、何时回退、何时止损”的决策更稳健。更长远地看，我们希望把“以代码为第一性原语”的多智能体方法论，推广到材料、药物、气候等同样代码密集的科学领域。
